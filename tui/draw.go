package tui

import (
	"aporia/ansi"
	"fmt"
	"strings"
)

const horizontal = "─"
const vertical = "│"

const tlCorner = "┌"
const trCorner = "┐"
const blCorner = "└"
const brCorner = "┘"

const boxHeight = 6
const boxWidth = 30

const _asciiArt = `;;::::'.                                                      .''''''','',,'.......   .  .......'''',;;::::;,......  .....',;::::::;,;::::::::::::::::::::::::;,,,'',,','','','... ...    ..''.............             .',,'''''',,'..  ...    .........                               ...';;;;;;;;;;;;;;;;
OO00Ox;......................................................,cloooolloloddc'............;:cccclllldxkkOOOOx:...........,:ldkO0OOOkddkOOOOOOOOOOOOOOOOOOOOOO0Okxdooooooooollllc,...........;oxolllllcccc;...............'cxxdooollool:,....................................................;dkkkkkkkkkkkkkkk
00O0Oo'....................................................':lolooooooodkko,...........,:loooooooodkO0OOOOOo,.........,:lodxO00O00kdkO0000000000000000000000000Oxdooooolllllllll:,.........'lkkdoooooooooc,..............,oxxdooooooool;'...................................................lkkkkkkkOOOOOOOO
0000x;...................................................':looooooooodxxxd:..........';coooooooodxOOOO0OOOx:........';lodkOOOO00OkxxO000000000000000000000000000Oxdolllllooooooooc,.........:xOkxdooooooooc;.............'lxkxdolcclllllc,..................................................;xkkkkkkOOOOOOOO
000Oo'..................................................;coooooooolloddxxl'.........,clooooooodxkO00OO000Ol'......';codxkOO00000OkxO00O00000000000000000000000000Oxoooooooooooooooo:'.......'lk0Okdoodoooool:'............ckOOOkdollcccclc;'................................................'lkOOOOOOOOOOOOO
000x:.................................................,cloooooolllloxkOOko'.......';coooooooodkOOO00OO000x:......,:lodkOOO000000kxO0000000000000000000000000000000kxddddooooooooodxxl,.......;dOOOkxdooooooolc,...........,dOOOOOkdoooolllc:,................................................:xOOOOOOOOOOOOO
000d,...............................................':loooollccloxkO0OOOx:.......':looooooodxkOOO000OOO0Oo,....';looxOO00000000Oxx00O00000000000000000000000000000OkxddoooooooooodkOOo;......'lkO00Oxdooooooool;'.........'lO0OO0Okxdoooooool;'..............................................,lkOkOOOOOOOOOO
00Oc...............................................;clooollllloxkO00OO00d,.....',cooooooodxkO0OOO0000000x:....,coodxO0000000000kxk0000000000000000000000000000000000kxdoodooooodddkO0Od;......:xOO00Okxoooooooool;.........:x0OO000Oxdooooooooc,.............................................'cxkkkOOOOOOOOO
00x,.............................................,coolllclloodkOOOOOO00Ol'....';looooooodxOO00OOO000OO00d,..,:loodkO0000O0000OOxxO00000000000000000000000000000000000kxdoddoooodoxOO00Od;'....,oO00000kxoooooooxkd:'.......,dOOO0000Okdooooooool:'............................................;dkkOOOOOOOOOO
0Oo'...........................................':lolccclooodkO00OO0000Ok:....,:ooooooodxkOO00000000OOOOkl,.;looodkO00000O0000OkxkO000000000000000000000000000000000000OxdooooooodxO0O00Ox:'....ck0OOOOOkdoooolodkOkc'......'lOO000OO00kxdooooooooc;...........................................,okOOOOOOOOOOO
0kc...........................................;loolcllooodxkO0OO0O0000Od,.'.,cooooododkOOOOkxdolc:;;,,,'....,,,;coxkO00000000OkkO00000000000000000000000000000000000000OxooodooodkO000000x:.....;;;;,,,''...'''';:lc;.......cxO0000000OOkdooooooool:'.........................................'cxOOOOOOOOOOO
0k;..........................................,cooooooooodkO000000O0000Oo'..,coooodoooool:;,'...'',;;;;;;,,;;,,''...',:ldkO00OOkk0000000000000000000000000000000000000000kdoodoodxkO00kdl:;'......,;:::cccccc:::;;,''........;xOO000000O0Okxdooooooooc,.........................................:xOOOOOOOOOOO
0x,..........................................,cooooooodxkO00OO000OO0OOkl'.,cooolc:,'''',;:ccoddxkkkkxxdolodddxxxddlc;,'';cdOOkkO0000000000000000000000000000000000000000OkdoooooxkOxc,..';:c:,..:dkkkkkkkkkkkkkkkkkxdoc,....'cdk000000000OOxdooooooool;'.......................................;dOOkOOOOOOOO
0d,..........................................'coooooodkOOO00000000O0O0kc',cll:,'',;cldxxkkkkkxdlc;,''.........',:ldxkkxdodkOOxxO00000000000000000000000000000000000000000OkdooddxOko:codxkkkxl,.,clc:;,''''',;:cloxkkkkd:.....',:oxO00O0000Oxdoooooooolc,......................................,okOkOOOOOOOO
Oo'...........................................coooodxkO0OO000000000000x:,;;'.';ldxkkkOkkkkxo:,...    .   ..     ...,coxkkOOOkxk0000000000000000000000000000000000000000000OxdoodkO000OOOkkkxdc'..... .         ....,:oxkd:'.'coc,',:okO00000Oxdoooooooool;.....................................'lkOkOOOOOOOO
Ol............................................:ooodxOOOOO0000000000000d,...,ldkOkkkkkkkkdc,..  ....    ..           .'cdxkOOOxk00000000000000000000000000000000000000000000Oxddxk000OOOkkxl;..   .. ..      .   ..  ..':od:''lxkxo:'.,cxOO000Okdoooooooool:'....................................cxOkkOOOOOOO
kc............................................;lodkOOOOO000000000000Oo;..:oxkkkkkkOkkxxl,.  ...   ......             ..,oxkO0O000000000000000000000000000000000000000000000OkxdxO000OOOko;. ...  .                     ..;:,,lkkkkkdc'.'cdO0000kdoooooooool;....................................:xOkOOOOOOOO
k:............................................;oxkOOOOOO0000000O00Od;..;oxkkkkkkkOkkOd:... ............                .,oxkOO0000000000000000000000000000000000000000000000OkxkO000OOkl'. ...   .                       ...,lxkkkkkkd:...:dOOOOkxooooooool,....................................:xkkOOOOOOOO
x;............................................;dkOOOOOO0000000O00kc'.,cdkkkkOOOkOO00x;...... ..........                 .;dOOO00000000000000000000000000000000000000000000000OOO0000KOl... ...   .                          .:dkkkkkkkxo;..'cxOO0Oxdooooooc'....................................:xkkOOOOOOOO
x;............................................:xOOOOOO000000000Od;..;dkkkkkkkO0KKXKx;. ... .... .......                . .cO000O000000000000000000000000000000000000000000000000000KKd'...........                          ..:dkkkkkkkkxc'..;okOOOxoooooo;.....................................;dkkOOOOOOOO
x,............................................;xOOOOO000000000kc'..:dkkkkOO0KKKKKKk;... .............                  ...'o0K000000000000000000000000000000000000000000000000000000k;...........                        .    .:kOkkOkkkkxl'..'okOOOxodool;.....................................;dkkOOOOOOOO
x,............................................;dOOOOOOOO00OO0x:..'cxkOkkO00KKXKKKk:.... ...........                     . .:k0000000000000000000000000000000000000000000000000000000o.....  ....                            .  .cO0OOOkkkkko,..'lkOOOxoodl,.....................................,dOkOOOOOOOO
x,............................................,oOOOOOOO00OOOx;...:xkkOOO0KKXXXKX0l. ..  ...........                     .. .o0K000000000000000000000000000000000000000000000000000KO:... .  ....                                'dKK0Okkkkkko,..'okOOkdooc'.....................................,dkkOOOOOOOO
x,............................................'lkO00OOO0OO0x:...;dkkkO0KKKXXXKKKx'.... ............                      . .:k0000000000000000000000000000000000000000000000000000Kx,....   ....                                .:kKK00Okkkkxl...,dOOOxooc......................................,dkkOOOOOOOO
d,............................................'ckOO00OOOO0kc...,oxkkO0KXXXXKKKK0l.... ..............                    ..  'd000000000000000000000000000000000000000000000000000K0d'............                             ...'o0KKK0Okkkkd:...:x0Oddo:......................................,okkOOOOOOOO
d'.............................................:xOO00OO00Oo'..'lxkOO0KKKXXXKKKKO:....  ..............                    .  .l000000000000000000000000000000000000000000000000000K0l. ...........                              . .c0KKXK0Okkkko,..,oOOxdo;......................................'okkOOOOOOOO
d'.............................................;dOO00000Ox:...;dkkkOKXXXXXXKKKKk;....   .............                     . .cO00000000000000000000000000000000000000000000000000KOc.............                              . .:OKKXXK0OkkOx:...lkOxdl,......................................'lkOOOOOOOOO
o'.............................................,oOOOOO00Od,...cxkkO0KXXXXXXKKKKk,..... ..............                     . .:O00000000000000000000000000000000000000000000000000KO;... .........                              . .;kKKKXXKOkkkko'..:xkxol,......................................'lkOOOOOOOOO
o'.............................................'lkOOOOO0Oo...'lkkkO0KKKKXXXXXKKx,...................                     .. .:k00000000000000000000000000000000000000000000000000Kk;............                   .             .;kKKKKXK0kkkkd;..;dkdoc'.......................................cxOOOOOOOOO
o'..............................................ck0OOOO0kc. .'okkkO0KKKKXXXXXKKk,..................                  .... . .cO00000000000000000000000000000000000000000000000000Kk,...  ....                          ..      . .;kKKKKKK0OkkOx;..,dkxdc........................................:xOOOOOOOOO
o'..............................................:xOOOOOOkc. .'okkkO0KKXXXXXKKKKk;..................                  .    ...cO00000000000000000000000000000000000000000000000000Kk;...  ....                                 .  .cOKKXKKKK0kkOx:..;dkxoc........................................:xkOOOOOOOO
d'..............................................;xOOO00Okc. .'okkkO0KKXXXXKKKKK0c..................             .';:cc;'.. ..lO00000000000000000000000000000000000000000000000000KO:.........                      ..;clll:,.. ...o0KKXXKKK0kkkx:..;xkdo:........................................;dkOOOOOOOO
d'..............................................,dOOO0OOOl...'lkkkkOKKXXXXKKKKXKd'...................  .    . .'lkKKXXKOd;..,d000000000000000000000000000000000000000000000000000K0c...........                   .ckKXKXXK0x:...,xKKKXKKKK0kkOx;..:xkdl;........................................;dOkOOOOOOO
d'..............................................,dOOO0OOOo'...cxkkkO0KKKKXXXXKKXO:..................... .. .. .o0KKKXKKKKx,.cO000000000000000000000000000000000000000000000000000KKo....... ... ..             ...cOKKKXXKKKKOc..o0XKXXXXXK0kOkd,..lkkdl;........................................,dOkOOOOOOO
d'..............................................,oOOO0O00x;...,okkkkOKKKKKXXXKKXKk;.... ............... .. .. 'xKKKKXKKKXO;,d0000000000000000000000000000000000000000000000000000KKx,...... ... ....           ..'dKKKKKKKXKK0o'cOKXKXXXXKKOkOxc..,dkkdl;........................................,oOOOOOOOOO
d'..............................................'okO0000OOd'...:dkkkk0KKXKKKKXXKXKd,...................     ...lOKKKXXKKKd;cOK0000000000000000000000000000000000000000000000000000K0l...... ...                ...o0KKKKKKXKKOcckKXKXXXXXK0Okkd;..:xOxdl,........................................'oOOOOOOOOO
o'..............................................'oOOO000OOOo,...cxkkkO0KXKXXXXKKKXKd,.... ............   ..  ..'lOKKKXK0d,:x0000000000000000000000000000000000000000000000000000000Kk:. ..  .                    .,oOKKXKKK0xcckXXXXKKKXXKOOkdc,.,oOOxdl'........................................'okOOOOOOOO
o'..............................................'oOOO0O0OO00o,...cxkkk0KKKXKKKKXXKKKx;....  ................   ..,cdxdo:',o00O00000000000000000000000000000000000000000000000000000KKk:.    .  ..               .. .':lool:,;lkKKXXXKKKKK0OkdlldxxO0Oxoc'........................................,okOOOOOOOO
o'..............................................'oOOO0OO00OO0x:..,cdkOO0KKXXKXXXXXXKKOc.....................       .....,dO0000000000000000000000000000000000000000000000000000000000KOl'.      .                 .      ..:x0KKKXKKKKKK0OOkxO000000kdoc'........................................,okOOOOOOOO
o'..............................................'oOOO0OOOOO00OOxodxxkkkO0KKXKKXXXXKKXK0x:.... .. ..... .....         ..ck0000000000000000000000000000000000000000000000000000000000000K0kl,..  ..                   .  .'cx0KKKKKKKKXKKK0OO000000000Oxoc'........................................'okOOOOOOOO
o'..............................................'oOOO0O00OOO0000000000OOO0KKKKKKXXKKXKXX0xc'.. ... .... ......    ..'cx000000OO000000000000000000000000000000000000000000000000000000000KKOxl;..   .....  ...      ..,cdOKKKKKXKKKKKKK000000000000O0Odoc.........................................'lkOOOOOOOO
o'..............................................'oOO000000000000000000000000KKKKXXXXXXXXXXKOkoc;,'..............,:lxO0KK000000000000000000000000000000000000000000000000000000000000000000KKK0Oxo:;'..........',:coxO0KKKKKKKKKXKKKK0000000000000000kdo:.........................................'lkOOOOOOOO
o'..............................................'oOO000000000000000000000000000KKKKKKKKKKKKXXXKK0OOkkxxdddddxkOO0KKKK0000000000000000000000000000000000000000000000000000000000000000000000KK0KKKKK0OOkkkkkkOO0KKXXXXXXKKKKKKKKKK0000000000000000000kdo:.........................................'ckOOOOOOOO
o'..............................................,oOO0OO000000000000000000000000000000000000KKKKKKKKXXXXXXKKKKKKK00000000000000000000000000000000000000000000000000000000000000000000000000000000000000KKKKKKKKKKKKKKKKKKK00000000000000000000000000Okdo:..........................................:xOOOOOOOO
o'..............................................;dOOOOO00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000Oxdo:..........................................:xOOOOOOOO
o'..............................................;xOOOOO00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000Oxdo;..........................................;xOOOOOOOO
o'..............................................;xO000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000Oxdo;..........................................;xOOOOOOOO
o'..............................................;x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000Odoo,..........................................;xOOOOOOOO
d'..............................................;xOOO000OOO0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000kddl,..........................................;xOOOOOOOO
x,..............................................;xOOOOOOOO00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000kddl,..........................................;xOOOOOOOO
k;..............................................;xOOOOOO000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000Oxdol,..........................................;xOOOOOOOO
Oc..............................................;dOO0OOO000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000Oxool'..........................................;xOOOOOOOO
Oc..............................................,dOOOOO0000000000000000000000000000000000000000000000000000000000OxllccllcloooooooooooooooooooooooooooddddddddddddddxxxxxxxxxxxxxxxxkO000000000000000000000000000000000000000000000000000000000000Odooc'..........................................;xOOOOOOOO
0l..............................................,oOOOOO0000000000000000000000000000000000000000000000000000000000k;.......',;::::::::::::::::::::::;;;;;;::::::::;;:::::::::::::::::cok0000000000000000000000000000000000000000000000000000000000Okdoo:...........................................:xOOOOOOOO
0o..............................................'ckOOO00000000000000000000000000000000000000000000000000000000000d'......';::::::::::::::::::::::::::::::::::::::::::::::::::::::::::cdO000000000000000000000000000000000000000000000000000000000Okddo;...........................................:kOOOOOOOO
0o'..............................................;dOO00OOOO00000000000000000000000000000000000000000000000000000Ol......,;::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::lxOOO000000000000000000000000000000000000000000000000000000Okdoc'...........................................ckOOOOOOOO
0d'..............................................'lkOOOOO0000000000000000000000000000000000000000000000000000000Oc....';::::ccclllloooooooooooooooooooollllcc::::::::::::::::::::::::::dOOO000000000000000000000000000000000000000000000000000000Oxdo:............................................ckOOOOOOOO
0x,...............................................,dOOOO00000000000000000000000000000000000000000000000000000000kc....;:ccloddddddddddddddddddddddddxxxxxxdddoollc:::::::::::::::::::::lkOO000000000000000000000000000000000000000000000000000000Oxdc'...........................................'ckOOOOOOOO
Kx;................................................:xOOO00000000000000000000000000000000000000000000000000000000k:...;codddxxxxxxdddddddddddddddxxxxxxxxxdxxxxddddolcc::::::::::::::::;cxOO000000000000000000000000000000000000000000000000000000kdl,............................................'ckOOOOOOOO
Kk;.................................................:xOO00000000000000000000000000000000000000000000000000000000Oc..:ldxxxxdddxxdxxxxxxxxxxxxxxxddxxxxxxxxxddxxxxxxxddolc::::::::::::::cxOO000000000000000000000000000000000000000000000000000000ko,.............................................'ckOOOOOOOO
KO:..................................................:xOOO000000000000000000000000000000000000000000000000000000Oo';odddxxxddddxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxdxxdddxdddolc:::::::::::cdO000000000000000000000000000000000000000000000000000000Oo;..............................................'lkOOOOOOOO
KOc...................................................,okO0000000000000000000000000000000000000000000000000000000o;cdddxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxddolcc:::::::;:dO00000000000000000000000000000000000000000000000000000Oo,...............................................'lkOOOOOOOO
K0l....................................................':xOOO0000000000000000000000000000000000000000000000000000dcoxdddxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxdddocc:::::;cx0000000000000000000000000000000000000000000000000000Od:.................................................'lkOOOOOOOO
K0o...............................   ....................':dO0OO0000000000000000000000000000000000000000000000000kooxdddxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxddddddoc::::;ck00O00000000000000000000000000000000000000000000000Ox:...................................................'lkOOOOOOOO
K0d'........................................................;oxO00OO000000000O00000000000000000000000000000000000Oddxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxdddddddxxxxxxxxxxxddddxdolc:::lk00000000000000000000000000000000000000000000000Okd:'....................................................'lkOOOOOOOO
KKx,..........................................................':okOOOO00000000000000000000000000000000000000000000xddxxdxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxdddddddddddddddddddddddxddol::dO000000000000000000000000000000000000000000000kdc,.......................................................'okOOOOOOOO
KKx,.............................................................':oxOO0OOOO000OO000000000000000000000000000000O00Odddddxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxdddddddddddddddddddddddxdddoclk000000000000000000000000000000000000000000Okdc,..........................................................'oOOOOOOOOO
KKk;................................................................':oxkO0OO00OOOO00000000000000000000000000000O00xodddxxxxxxxxxxxxxxxxddddddddddddddddddddddddddddddddddddddddxdddolxO0000000000000000000000000000000000OO00Okdl;'.............................................................'oOOOOOOOOO
KKO:....................................................................,cdxkO00OOOO000000O000000000000000000000000OxddddxdddxxddxxxxxxddddddddddddddddddddddddddddddddddddddddddddoodO0O000000000000000000000000000000000Oxoc;'.........  ... ............ .....................................,dOOOOOOOOO
KKOc............................... ........................................,coxkO00OO000000000000000000000000000000OxoodxddxxdddddddddddddddddddddddddddddddddddddddddddxxxddddxdoldOO0000000000000000000000000000000Oxoc,................................ .....................................,dOOOOOOOOO
0K0o............................... ............................................':ldxOO00000OO00000000000000000000000OxoodxxxddxddddddddddddddddddddddddddddddddddddddddddxxdddddoldO00O0000000000000000000000000Okdl;'.................................... .....................................,dOOOOOOOOO
000d'.............................. ............................................ ....,coxkOOOOO00000000000000000000000OkdoddxddddddddddddddddddddddddddddddddddddddddddddddddddoooxO000000000000000000000000Okdl:,...........  ............................ .................. ..................;dOOOOOOOOO
K0Kx,.........................................................................  .... ....';:ldkOO00OOO00000000O000O00000Odoodxxdddxxxddddddddddddddddddddddddddddddddddddddxdddodk00000000000000000000OOkdo:,................................................. ..................................;xOOOOOOOOO
KKKO:..........................................................................................,:ldxkOOOOOOOOO00000000O000kdlodxxdddddddddddddddddddddddddddddddddddddddddddddxkOO000000000000000Okxdl:,.................................................. ..  ..................................;xOOOOOO000
KKK0c...............................................................................................,:codkOOOO0OO0000OOOO00OxdloddddddddddddddddddddddddddddddddddddddddddddxOO00000000000OOkkdlc;'....................................................... ......................................;xOOOOOO000
KKKKo....................................................................................................',:ldxkOO00OOOOO0000OkdoooddxdddddddddddddddddddddddddddddddddddxkOO00000000Okkxdool;............................................................ ......................................:xOOOOOO000
KKKKx;..................................................................................................... .'cooddxkOOOOO000OOOOkdooooddddddddddddddddddddxxxddddddddxkkO000OOOkkxddoooollol,..........................................................  ... ...................................:xOOOOO0000
KKKKOl..................................................................................................... .'colllllloodxkkOOOO000OkxddoooodddddddddddddddddddddxxkkOOOOkkxddoollloooooooooc'..........................................................  .. ....................................ckOOOOO0000
KKKK0d,....................................................................................................  .:loooooollolllooddxkkOOO00OOkkkxxxdddddddddxxxkkkOOOkkxddooooooooooooooooooooo:...................................................................................................'lkOO0OO0000
KKK0Kk:.......................................................................................................;loooooooooooooooooooooodddxxkkkOOOOOkkkkkkkkxxxdddooooooooooooooooooooooooool;.............................................................. ....................................'lkOO0O00000
KKKKK0c..................................................................................................... .,looooooooooooooooooooooooollllooooooolllllllllooooooooooooooooooooooooooooool;.............................................................  ....................................,oOOOO00O000
KKKKK0o..................................................................................................... .,loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooool,............................................................  ........... .........................;dOOOO00O000
KKKKKKx,.................................................................................................... .,loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooool,...............................  ............................ ..........    .......................:xOOOO00O000
KKKKKKk;.................................................................................................... .,loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooool,............................................................. ......... ..  ......................'ckOOOOO0O000
KKKKKKOc...........................................................'..........................................,coooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooool,..................................'........................................ ......................'lkOOOOO0O000`


func (self *Tui) Draw() error {

	// Reset cursor position
	if self.shouldBeRedrawn {
		ansi.Clear()
		ascii := newAscii(_asciiArt)
		self.shouldBeRedrawn = false
		ansi.MoveCursor(0, 0)
		ascii.draw(self.TermSize)
		ansi.MoveCursor(0, 0)
		self.drawBox()
	}

	// Draw the message
	if self.lastDrawnMessage != self.message {
		self.lastDrawnMessage = self.message
		ansi.MoveCursor(2, 0)
		ansi.EraseChars(boxWidth)
		self.drawLine(self.message)
	}

	// Draw the currently selected field
	thisLine := self.fields[self.position].draw()

	ansi.MoveCursor(self.position+3, 0)
	ansi.EraseChars(boxWidth)
	self.drawLine(thisLine)

	ansi.MoveCursor(self.position+3, len(thisLine)+2)

	return nil
}

// Draw the vertical margin.
func drawMargin(height int) {
	for i := 0; i < (height-boxHeight)/2; i++ {
		fmt.Print("\n\r")
	}
}

func eraseLine(num int) {
	fmt.Print("\033[", num, "K")
}

// Draw the box. Return the vertical lines taken up.
func (self Tui) drawBox() {
	fmt.Print(tlCorner, strings.Repeat(horizontal, boxWidth-2), trCorner, "\n\r")

	self.drawLine(self.message)

	for _, field := range self.fields {
		self.drawLine(field.draw())
	}

	fmt.Print(blCorner, strings.Repeat(horizontal, boxWidth-2), brCorner, "\n\r")
}

func (self Tui) drawLine(text string) {
	fmt.Print(vertical)
	fmt.Print(text)
	fmt.Print(strings.Repeat(" ", maxInt(boxWidth-2-len(text), 0)))
	fmt.Print(vertical, "\n\r")
}
